<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Attendance Form</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<style>
  body{
    font-family:"Poppins",sans-serif;
    background:#eef1f7;
    padding:25px;
  }

  .card{
    max-width:430px;
    margin:30px auto;
    background:white;
    padding:25px;
    border-radius:16px;
    box-shadow:0 10px 25px rgba(0,0,0,0.09);
    animation:fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from{opacity:0; transform:translateY(10px);}
    to{opacity:1; transform:translateY(0);}
  }

  input,button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:10px;
    border:1px solid #d1d5db;
    font-size:15px;
    transition:0.2s;
  }

  input:focus{
    border-color:#6366f1;
    box-shadow:0 0 5px rgba(99,102,241,0.3);
  }

  button{
    background:#1e40af;
    color:white;
    font-weight:600;
    cursor:pointer;
  }

  button:hover{
    background:#1d3bb8;
  }

  #msg{
    margin-top:10px;
    color:#10b981;
    font-weight:600;
  }

</style>
</head>

<body>

<div class="card">
  <h2>Student Attendance</h2>
  <p id="eventInfo" style="color:#4b5563;">Loading event...</p>

  <label>Name</label>
  <input id="name" placeholder="Full Name">

  <label>Division</label>
  <input id="division" placeholder="A / B / C">

  <label>Roll No</label>
  <input id="roll" placeholder="Roll Number">

  <label>Email</label>
  <input id="email" type="email" placeholder="abc@example.com">

  <button id="submitBtn">Submit</button>

  <p id="msg"></p>
</div>

<script>
const SUPABASE_URL="https://qdfwzuttffkpitplisop.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkZnd6dXR0ZmZrcGl0cGxpc29wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MzQ3NzMsImV4cCI6MjA3ODUxMDc3M30.ruo0v0XVE5RvUn_nvL0VlZwg3eh2VJnN2K_-0eCBWOI";
const supabaseClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

const EVENT_ID=new URLSearchParams(location.search).get("event");

async function loadEvent(){
  if(!EVENT_ID){
    eventInfo.innerText="Invalid Event!";
    return;
  }
  const {data,error}=await supabaseClient.from("events").select("*").eq("id",EVENT_ID).single();
  if(data){
    eventInfo.innerText=`Event: ${data.title} (${data.event_date})`;
  }
}
loadEvent();

document.getElementById("submitBtn").onclick=async()=>{
  const name=document.getElementById("name").value.trim();
  const division=document.getElementById("division").value.trim();
  const roll=document.getElementById("roll").value.trim();
  const email=document.getElementById("email").value.trim();

  if(!name || !division || !roll || !email)
    return alert("Fill all fields!");

  const {error}=await supabaseClient.from("attendance").insert([{
    event_id:EVENT_ID,
    name,division,roll_no:roll,email
  }]);

  if(error){
    alert("Error: "+error.message);
  }else{
    msg.innerText="Attendance Submitted âœ”";
    submitBtn.disabled=true;
    submitBtn.style.opacity="0.7";
  }
};
</script>

</body>
</html>
